ARG OPENJDK_IMAGE=maven-openjdk8:2022.09.30
ARG OPENJRE_JRE_IMAGE=openjdk8-jre:2022.09.30

FROM wayfair/${OPENJDK_IMAGE} as prepare

WORKDIR /app/build
COPY . /app/build

RUN mvn assembly:assembly -DdescriptorId=jar-with-dependencies

FROM wayfair/${OPENJRE_JRE_IMAGE}

ARG JAR_FILE=demo-0.0.1-SNAPSHOT-jar-with-dependencies.jar

WORKDIR /wayfair/app
ARG GID
ARG GROUP="www"
ARG UID="1001"
ARG USER="javamambauser"

ARG wf_version
ENV JAR_FILE=${JAR_FILE}
ENV version=${wf_version}
ENV GID ${GID}
ENV GROUP ${GROUP}
ENV UID ${UID}
ENV USER ${USER}

COPY --from=prepare /app/build/target/${JAR_FILE} /wayfair/app

ENTRYPOINT ["java","-jar","demo-0.0.1-SNAPSHOT-jar-with-dependencies.jar"]